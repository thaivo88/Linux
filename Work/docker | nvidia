#script in ~sfleisch
yum install -y http://mirror.centos.org/centos/7/extras/x86_64/Packages/container-selinux-2.68-1.el7.noarch.rpm 
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
yum install -y docker-ce-18.09.0-3.el7.x86_64 
#You need to install the repo def into /etc/yum.repo.d.
########################################
#controlling docker daemon
 systemctl start|restart|status docker.service (docker daemon)
#information for nvidia docker
 which nvidia-docker
 nvidia-docker  --version
 docker info
 nvidia-docker verison (more detail)
#list of repository
 docker images 
#install docker
 sudo yum -y install docker-engine
#install nvidia docker
 yum list installed nvidia-docker
#install nvidia container 
 yum list installed nvidia-container-runtime

 docker load -i tf18.08.tar
 docker tag [image id] [repositoy name]:[tag]

# stop docker container
 docker stop [container-name]
# list process of docker
 docker ps


#If docker daemon does not start and in a failed state check metadata file at : /var/lib/docker/devicemapper/devicemapper/metadata
#If the file has symbols delete docker directory : /var/lib/docker
 rm -rf /var/lib/docker
 systemctl restart docker.service
 
#if deleting the docker dir did not start docker
cd /etc/docker/
vi daemon.json
#delete the file and input only: {}
 
 #if docker was started too often force to start:
 systemctl reset-failed docker.service
 systemctl start docker.service
 
#script location
/admin/nodes/scripts/admindocker start 

#other commands
 systemctl stop docker.service

docker pull nvcr.io/nvidia/tensorflow-18.09-py3
docker images
nvidia-docker run -ti --rm nvcr.io/nvidia/tensorflow-18.09-py3 /bin/bash
#ti terminal interactive rm remove the container instaint
exit

############## rhel 8 ##############
dnf install https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm
sudo dnf install docker-ce

dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo
dnf repolist -v
dnf list docker-ce --showduplicates | sort -r
dnf install docker-ce-3:19.03.13-3.el8 
####################################


############# ubuntu 18 ############
# Install Docker
#
yes | apt-get install apt-transport-https  ca-certificates  curl  gnupg-agent   software-properties-common
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
apt-key fingerprint 0EBFCD88
add-apt-repository    "deb [arch=amd64] https://download.docker.com/linux/ubuntu  $(lsb_release -cs)  stable nightly test"
yes | apt-get install docker-ce docker-ce-cli containerd.io

# Install Nvidia-Docker
#
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey |   sudo apt-key add -
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list |  sudo tee /etc/apt/sources.list.d/nvidia-docker.list
yes | apt-get update
yes | apt-get install nvidia-docker2
###################################
